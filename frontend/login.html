<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Login – Fato ou Fake?</title>
    <style>
        :root { --primary-color: #3a86ff; --dark-color: #2b2b2b; --light-gray: #f7f7f7; --border-color: #dcdcdc; }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: "Segoe UI", sans-serif; background: var(--light-gray); color: #333; display: flex; flex-direction: column; min-height: 100vh; }
        .navbar { background: #ffffff; padding: 10px 32px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,.06); font-size: 14px; }
        .nav-links { display: flex; gap: 24px; }
        .nav-links a { color: #666; text-decoration: none; }
        .nav-buttons a, .nav-buttons button { padding: 8px 16px; font-size: 14px; border-radius: 6px; border: 1px solid #d0d0d0; background: #fff; cursor: pointer; margin-left: 10px; text-decoration: none; color: #333; }
        .nav-buttons .dark { background: var(--dark-color); color: #fff; border: none; }
        main { flex: 1; display: flex; justify-content: center; align-items: center; }
        .hero { text-align: center; padding: 20px; }
        .hero h1 { font-size: 42px; font-weight: 700; margin-bottom: 8px; }
        .hero h1 strong { color: #000; }
        .hero p { color: #555; font-size: 16px; margin-bottom: 30px; }
        .login-form { background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,.1); width: 100%; max-width: 400px; display: flex; flex-direction: column; text-align: left; }
        .login-form label { font-size: 14px; font-weight: 600; margin-bottom: 8px; }
        .login-form input { padding: 12px 16px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 15px; margin-bottom: 16px; }
        .login-form button { padding: 14px; font-size: 16px; border-radius: 8px; border: none; background: var(--dark-color); color: #fff; cursor: pointer; font-weight: 600; transition: background-color 0.2s; width: 100%; }
        .login-form button:disabled { background-color: #aaa; cursor: not-allowed; }
        .forgot { font-size: 13px; color: var(--primary-color); text-decoration: none; margin-top: 16px; display: inline-block; text-align: center; width: 100%; }
        #notification { padding: 12px; margin-top: 20px; border-radius: 8px; color: #fff; font-weight: 600; display: none; }
        #notification.error { background-color: #dc3545; }
    </style>
</head>
<body>
    <header class="navbar">
        <div class="nav-links">
            <a href="#">Projetos</a>
            <a href="#">Membros</a>
            <a href="#">Recursos</a>
            <a href="#">Contato</a>
        </div>
        <div class="nav-buttons">
            <a href="login.html" class="btn light">Entrar</a>
            <a href="registrar.html" class="btn dark">Registrar</a>
        </div>
    </header>
    <main>
        <section class="hero">
            <h1><strong>Fato</strong> ou <strong>Fake?</strong></h1>
            <p>Grupo de extensão da UFSCAR</p>
            <form class="login-form" id="loginForm">
                <label for="email">Email</label>
                <input type="email" id="email" placeholder="you@example.com" required value="teste@email.com" />
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="••••••••" required value="123456" />
                <button type="submit" id="submitButton" class="btn dark full">Entrar</button>
                <div id="notification"></div>
                <a href="#" class="forgot">Esqueceu a senha?</a>
            </form>
        </section>
    </main>
    <script>
        const API_URL = 'http://127.0.0.1:5000/api';
        document.getElementById('loginForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            const submitButton = document.getElementById('submitButton');
            const notification = document.getElementById('notification');
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            submitButton.disabled = true;
            submitButton.textContent = 'Entrando...';
            notification.style.display = 'none';
            try {
                const response = await fetch(`${API_URL}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: email, senha: password })
                });
                const result = await response.json();
                if (response.ok && result.success) {
                    // Guarda tanto o token como o perfil do utilizador
                    localStorage.setItem('authToken', result.token);
                    localStorage.setItem('userRole', result.role);
                    window.location.href = 'dashboard.html';
                } else {
                    throw new Error(result.message || 'Email ou senha inválidos.');
                }
            } catch (error) {
                notification.textContent = error.message;
                notification.className = 'error';
                notification.style.display = 'block';
                submitButton.disabled = false;
                submitButton.textContent = 'Entrar';
            }
        });
    </script>
</body>
</html>